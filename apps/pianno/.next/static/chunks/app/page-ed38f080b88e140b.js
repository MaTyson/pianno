(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6767:function(e,t,s){Promise.resolve().then(s.bind(s,338)),Promise.resolve().then(s.bind(s,99)),Promise.resolve().then(s.bind(s,9021)),Promise.resolve().then(s.bind(s,958))},930:function(e,t,s){"use strict";s.d(t,{Av:function(){return l},L0:function(){return r},yg:function(){return n}}),s(9328);var a=s(3938),r=(0,a.$)("6d77e837512fa4478576a5c8cfede51f224664f3"),l=(0,a.$)("1ff87d779923d4a9c58fe4efd6af26311d672606"),n=(0,a.$)("802e4fe3d802fa940db06d271a6a0b158a1605d2")},338:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Q}});var a=s(2872),r=s(1521),l=s(458),n=s(5273),i=s(5626),o=s(5553),d=s.n(o),c=s(8206),u=s(4209),x=s(6589);let m=e=>{let{height:t,width:s}=e,a=(0,u.useRef)(null);return(0,u.useEffect)(()=>{let e=a.current;return(e=document.createElement("canvas")).width=s,e.height=t,a.current=e,()=>{var t;null==e||e.remove(),null===(t=a.current)||void 0===t||t.remove(),a.current=null}},[t,s]),a};var h=e=>{let t=m({height:e.height,width:e.width}),s=(0,r.uG)(),l=(0,r.VN)(),{mode:n,size:o}=(0,r.uu)(),{setLabel:d}=(0,r.WX)(),h=t.current,f=null==h?void 0:h.getContext("2d"),p=(0,u.useMemo)(()=>c.jyi.from(null!=h?h:c.xEZ.EMPTY),[h]);(0,u.useEffect)(()=>{if(!f)return;let t=new Image;t.src=l,t.onload=()=>{f.clearRect(0,0,e.width,e.height),f.drawImage(t,0,0),p.texture.update()}},[l,f,p.texture,e.width,e.height]);let g=(0,u.useRef)(null),j=(0,u.useRef)(null),b=(0,r.ER)(),v=(0,i.Y0)(),[y,N]=u.useState(!1);return(0,u.useEffect)(()=>{let e=e=>{var t;if(!f||(f.fillStyle=s,"mouse"!==e.pointerType)||0!==e.button)return;N(!0);let a=null!==(t=null==b?void 0:b.toWorld(e.global))&&void 0!==t?t:e.global;g.current=a;let r=Math.round(g.current.x-o/2),l=Math.round(g.current.y-o/2);if("eraser"===n){f.clearRect(r,l,o,o);let e=[];for(let t=0;t<o;t++)for(let s=0;s<o;s++)e.push({x:r+t,y:l+s})}else"pen"===n&&f.fillRect(r,l,o,o);p.texture.update()},t=e=>{var t;let s=null!==(t=null==b?void 0:b.toWorld(e.global))&&void 0!==t?t:e.global;if(j.current=s,f&&g.current&&y){let e=(0,x.qw)(g.current,j.current),t=(0,x.dI)(g.current,j.current);for(let s=0;s<e;s++){let e=Math.round(g.current.x+Math.sin(t)*s-o/2),a=Math.round(g.current.y+Math.cos(t)*s-o/2);"eraser"===n&&f.clearRect(e,a,o,o)}p.texture.update(),g.current=j.current}},a=e=>{h&&(N(!1),d(h.toDataURL()))};return v.stage.on("pointerdown",e),v.stage.on("pointerup",a),v.stage.on("pointermove",t),()=>{v.stage.off("pointerdown",e),v.stage.off("pointerup",a),v.stage.off("pointermove",t)}},[v.stage,n,o,h,s,f,y,e.height,e.width,d,p.texture,b]),(0,a.jsx)(i.jy,{blendMode:c.T$b.OVERLAY,texture:p.texture})};let f=()=>{let e=(0,r.uG)(),{size:t}=(0,r.uu)(),[s,l]=(0,u.useState)(new c.E9j(0,0)),n=(0,u.useCallback)(s=>{s.clear(),s.beginFill(e),s.drawRect(0,0,t,t),s.endFill()},[t,e]),o=(0,i.Y0)(),x=(0,r.ER)(),m=d()(e=>{var s;let a=null!==(s=null==x?void 0:x.toWorld(e.global))&&void 0!==s?s:e.global;l(new c.E9j(a.x-t/2,a.y-t/2))},16),h=(0,u.useCallback)(m,[m]);return(0,u.useEffect)(()=>(o.stage.on("pointermove",h),()=>{o.stage.off("pointermove",h)}),[h,o.stage]),(0,a.jsx)(i.TC,{alpha:.7,blendMode:c.T$b.DIFFERENCE,draw:n,x:s.x,y:s.y})},p=()=>{let e="#808080",{size:t}=(0,r.uu)(),[s,l]=(0,u.useState)(new c.E9j(0,0)),n=(0,u.useCallback)(s=>{s.clear(),s.beginFill(e),s.drawRect(0,0,t,t),s.endFill()},[t,e]),o=(0,i.Y0)(),x=(0,r.ER)(),m=d()(e=>{var s;let a=null!==(s=null==x?void 0:x.toWorld(e.global))&&void 0!==s?s:e.global;l(new c.E9j(a.x-t/2,a.y-t/2))},16),h=(0,u.useCallback)(m,[m]);return(0,u.useEffect)(()=>(o.stage.on("pointermove",h),()=>{o.stage.off("pointermove",h)}),[h,o.stage]),(0,a.jsx)(i.TC,{alpha:.7,blendMode:c.T$b.DIFFERENCE,draw:n,x:s.x,y:s.y})};var g=()=>{let{mode:e}=(0,r.uu)();return e?(0,a.jsxs)(a.Fragment,{children:["pen"===e&&(0,a.jsx)(f,{}),"eraser"===e&&(0,a.jsx)(p,{})]}):null},j=s(5250),b=s(1011),v=s(1911),y=s(3299),N=s(9350),w=s(7943),k=e=>{let{}=e,[t,s]=(0,u.useReducer)(e=>!e,!1),{src:l}=(0,r.m2)();return(0,y.y1)("h",()=>s()),(0,a.jsxs)(w.Vq,{onOpenChange:s,open:t,children:["#"===l&&(0,a.jsx)("div",{className:"fixed bottom-12 right-4 z-10 text-center text-violet-300",children:(0,a.jsxs)("span",{className:"items-center justify-center font-mono font-semibold",children:["if you need help"," ",(0,a.jsx)(j.Z,{className:"inline-block h-4 w-4 animate-pulse stroke-violet-800"})," "]})}),(0,a.jsx)(w.hg,{asChild:!0,children:(0,a.jsx)(N.z,{className:"fixed bottom-1 right-1 z-10 opacity-90 shadow-lg",size:"icon",title:"help",variant:"outline",children:"?"})}),(0,a.jsxs)(w.cZ,{className:"sm:max-w-[425px]",children:[(0,a.jsx)(w.fK,{children:(0,a.jsx)(w.$N,{children:"Help"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-row items-start justify-between gap-1",children:[(0,a.jsxs)(v.default,{className:(0,x.cn)((0,N.d)({variant:"outline"}),""),href:"https://cnpem.github.io/pianno/",rel:"noopener noreferrer",target:"_blank",title:"help",children:["Documentation",(0,a.jsx)(b.Z,{className:"ml-1",size:16})]}),(0,a.jsx)("p",{className:"mt-1 text-xl text-input",children:" | "}),(0,a.jsxs)(v.default,{className:(0,x.cn)((0,N.d)({variant:"outline"}),""),href:"https://github.com/cnpem/pianno/issues",rel:"noopener noreferrer",target:"_blank",title:"help",children:["Report an issue",(0,a.jsx)(b.Z,{className:"ml-1",size:16})]})]}),(0,a.jsx)("p",{className:"text-sm font-semibold",children:"Keyboard shortcuts"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 rounded-md border border-input p-2",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Drag"}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,a.jsx)("p",{className:"text-xs",children:"hold"}),(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"Middle"}),(0,a.jsx)("p",{className:"text-xs",children:"or"}),(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"Right"}),(0,a.jsx)("p",{className:"text-xs",children:"mouse button"})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Zoom"}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-1",children:(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"Scroll"})})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Pen"}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"1"}),(0,a.jsx)("p",{className:"text-xs",children:"or"}),(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"p"})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Eraser"}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"2"}),(0,a.jsx)("p",{className:"text-xs",children:"or"}),(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"e"})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Load Image"}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-1",children:(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"3"})})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Save Annotations"}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-1",children:(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"4"})})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Toggle pairs view"}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-1",children:(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"5"})})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Undo"}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"6"}),(0,a.jsx)("p",{className:"text-xs",children:"or"}),(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"Ctrl"}),(0,a.jsx)("p",{className:"text-xs",children:"+"}),(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"z"})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Redo"}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"7"}),(0,a.jsx)("p",{className:"text-xs",children:"or"}),(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"Ctrl"}),(0,a.jsx)("p",{className:"text-xs",children:"+"}),(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"y"})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Fit view"}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-1",children:(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"8"})})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Eraser size"}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"up"}),(0,a.jsx)("p",{className:"text-xs",children:"/"}),(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"down"})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Help"}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-1",children:(0,a.jsx)("kbd",{className:"rounded-sm bg-violet-200 px-2 py-1 text-xs",children:"H"})})]})]})]})]})]})},z=s(930);let C=e=>{let{color:t,graphics:s,radius:a,shape:r,x:l,y:n}=e;switch(r){case"pointing-right":s.lineStyle(a/4,t,1),s.beginFill(t),s.drawPolygon([l+a,n,l-a/2,n-1.73*a/2,l-a/2,n+1.73*a/2]),s.endFill();break;case"pointing-left":s.lineStyle(a/4,t,1),s.beginFill(t),s.drawPolygon([l-a,n,l+a/2,n-1.73*a/2,l+a/2,n+1.73*a/2]),s.endFill();break;case"pointing-down":s.lineStyle(a/4,t,1),s.beginFill(t),s.drawPolygon([l,n+a,l-1.73*a/2,n-a/2,l+1.73*a/2,n-a/2]),s.endFill();break;case"pointing-up":s.lineStyle(a/4,t,1),s.beginFill(t),s.drawPolygon([l,n-a,l-1.73*a/2,n+a/2,l+1.73*a/2,n+a/2]),s.endFill();break;case"circle":s.lineStyle(a/4,t,1),s.beginFill(t),s.drawCircle(l,n,a),s.endFill();break;case"ring":s.lineStyle(a/4,t,1),s.drawCircle(l,n,a);break;case"alert":s.lineStyle(a/1.44,t,1),s.moveTo(l-a,n-a),s.lineTo(l+a,n+a),s.moveTo(l-a,n+a),s.lineTo(l+a,n-a)}return s};var R=e=>{let{}=e,t=(0,r.VN)(),[s,l]=(0,u.useState)(null),[n,o]=(0,u.useState)(0),d=(0,r.Wk)(),x=(0,r.ER)();(0,u.useEffect)(()=>{o(((null==x?void 0:x.screenHeightInWorldPixels)||5)/100)},[null==x?void 0:x.screenHeightInWorldPixels]),(0,u.useEffect)(()=>{(0,z.L0)(t).then(e=>{e&&l(e)})},[t]);let m=(0,u.useCallback)(e=>{e.clear(),s&&Object.values(s).forEach((t,s)=>{if(!t)return;let[a,r,...l]=t,i=a.color;if(!r){C({color:i,graphics:e,radius:n,shape:"ring",x:a.x,y:a.y});return}if(l.length&&l.forEach(t=>{C({color:i,graphics:e,radius:n,shape:"alert",x:t.x,y:t.y})}),d.vertical.includes(i)){let[t,s]=[a,r].sort((e,t)=>e.y-t.y);C({color:i,graphics:e,radius:n,shape:"pointing-down",x:t.x,y:t.y}),C({color:i,graphics:e,radius:n,shape:"pointing-up",x:s.x,y:s.y})}if(d.horizontal.includes(i)){let[t,s]=[a,r].sort((e,t)=>e.x-t.x);C({color:i,graphics:e,radius:n,shape:"pointing-left",x:s.x,y:s.y}),C({color:i,graphics:e,radius:n,shape:"pointing-right",x:t.x,y:t.y})}d.euclidean.includes(i)&&(C({color:i,graphics:e,radius:n,shape:"circle",x:a.x,y:a.y}),C({color:i,graphics:e,radius:n,shape:"circle",x:r.x,y:r.y})),e.lineStyle(n/4,i,1),e.moveTo(a.x,a.y),e.lineTo(r.x,r.y)})},[d,s,n]);return(0,a.jsx)(i.TC,{blendMode:c.T$b.OVERLAY,draw:m})},A=s(3753);let E=u.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsxs)(A.fC,{ref:t,className:(0,x.cn)("relative flex w-full touch-none select-none items-center",s),...r,children:[(0,a.jsx)(A.fQ,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,a.jsx)(A.e6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(A.bU,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});E.displayName=A.fC.displayName;var F=e=>{let{}=e,{maxSize:t,mode:s,size:l}=(0,r.uu)(),{setBrushSize:n}=(0,r.WX)();return(0,y.y1)(["up"],()=>n(l+1>t?t:l+1),{enabled:"eraser"===s}),(0,y.y1)(["down"],()=>n(l-1>0?l-1:1),{enabled:"eraser"===s}),(0,a.jsxs)("div",{className:"mt-4 flex w-full flex-col gap-2 px-2",children:[(0,a.jsx)(E,{className:"w-full",max:t,min:1,onValueChange:e=>n(e[0]),step:1,title:"".concat(s," size -- up/down"),value:[l]}),(0,a.jsxs)("span",{className:"text-center text-xs text-slate-400",children:[s," size: ",l]})]})},Z=s(9837),S=s(5065),M=s(2967),V=s(2896),W=s(462),T=s(1130);let D=T.fC,O=T.xz,Y=u.forwardRef((e,t)=>{let{className:s,align:r="center",sideOffset:l=4,...n}=e;return(0,a.jsx)(T.h_,{children:(0,a.jsx)(T.VY,{ref:t,align:r,sideOffset:l,className:(0,x.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})})});Y.displayName=T.VY.displayName;let L=e=>{let{colorLabel:t}=e,{euclidean:s,horizontal:l,vertical:n}=(0,r.Wk)(),{setNewColor:i}=(0,r.WX)(),o=(0,W.y1)(e=>{i(e,t)},300);return(0,a.jsxs)(D,{children:[(0,a.jsx)(O,{asChild:!0,children:(0,a.jsxs)(N.z,{className:"h-6 w-6",size:"icon",variant:"outline",children:["vertical"===t&&(0,a.jsx)(Z.Z,{className:"h-4 w-4"}),"horizontal"===t&&(0,a.jsx)(S.Z,{className:"h-4 w-4"}),"euclidean"===t&&(0,a.jsx)(M.Z,{className:"h-4 w-4"})]})}),(0,a.jsxs)(Y,{align:"start",className:"h-32 w-32 rounded-lg border bg-background p-1 shadow-lg",side:"top",children:["euclidean"===t&&(0,a.jsx)(V.gW,{color:s.slice(-1)[0],onChange:o,style:{height:"100%",width:"100%"}}),"horizontal"===t&&(0,a.jsx)(V.gW,{color:l.slice(-1)[0],onChange:o,style:{height:"100%",width:"100%"}}),"vertical"===t&&(0,a.jsx)(V.gW,{color:n.slice(-1)[0],onChange:o,style:{height:"100%",width:"100%"}})]})]})};var I=e=>{let{}=e,{euclidean:t,horizontal:s,vertical:l}=(0,r.Wk)(),n=(0,r.uG)(),{setColor:i,setNewColor:o}=(0,r.WX)();return(0,W.y1)((e,t)=>{o(e,t)},300),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-1 p-2",children:[(0,a.jsx)(L,{colorLabel:"vertical"}),(0,a.jsx)(L,{colorLabel:"horizontal"}),(0,a.jsx)(L,{colorLabel:"euclidean"}),(0,a.jsx)("div",{className:"col-span-1 ml-1",id:"vertical-pallete",children:(0,a.jsx)("div",{className:"space-y-1",children:l.map(e=>(0,a.jsx)("div",{className:(0,x.cn)(e===n&&"border-4","h-4 w-4 cursor-pointer rounded-full transition-all hover:scale-125"),onClick:()=>i(e),style:{backgroundColor:e===n?"transparent":e,borderColor:e},title:e},e))})}),(0,a.jsx)("div",{className:"col-span-1 ml-1",id:"horizontal-pallete",children:(0,a.jsx)("div",{className:"space-y-1",children:s.map(e=>(0,a.jsx)("div",{className:(0,x.cn)(e===n&&"border-4","h-4 w-4 cursor-pointer rounded-full transition-all hover:scale-125"),onClick:()=>i(e),style:{backgroundColor:e===n?"transparent":e,borderColor:e},title:e},e))})}),(0,a.jsx)("div",{className:"col-span-1 ml-1",id:"euclidean-pallete",children:(0,a.jsx)("div",{className:"space-y-1",children:t.map(e=>(0,a.jsx)("div",{className:(0,x.cn)(e===n&&"border-4","h-4 w-4 cursor-pointer rounded-full transition-all hover:scale-125"),onClick:()=>i(e),style:{backgroundColor:e===n?"transparent":e,borderColor:e},title:e},e))})})]})};let P=()=>(0,a.jsx)("div",{className:"fixed inset-y-0 left-1 z-10 my-auto h-fit items-center rounded-lg bg-background opacity-90 shadow-lg",children:(0,a.jsx)(I,{})}),_=()=>(0,a.jsx)("div",{className:"fixed inset-y-0 left-1 z-10 my-auto h-fit items-center rounded-lg bg-background opacity-90 shadow-lg",children:(0,a.jsx)(F,{})});var q=e=>{let{}=e,{mode:t}=(0,r.uu)();return(0,a.jsxs)(a.Fragment,{children:["pen"===t&&(0,a.jsx)(P,{}),"eraser"===t&&(0,a.jsx)(_,{})]})},$=s(1809);let X=(0,i.Wf)("Viewport",{applyProps:(e,t,s)=>{e.resize(s.app.screen.width,s.app.screen.height),s.setViewport(e)},create:e=>{let t=new $.l_({disableOnContextMenu:!0,events:e.app.renderer.events,ticker:e.app.ticker});return t.drag({mouseButtons:"middle-right"}).pinch().wheel().decelerate().clampZoom({maxHeight:1e4,maxWidth:1e4,minHeight:1,minWidth:1}),e.setViewport(t),t},willUnmount:(e,t)=>{e.options.noTicker=!0,e.destroy({baseTexture:!0,children:!0,texture:!0})}}),H=(0,u.forwardRef)(function(e,t){let s=(0,i.Y0)(),[n,o]=(0,l.i)(),{setViewport:d}=(0,r.WX)();return(0,a.jsx)(X,{app:s,height:o,ref:t,setViewport:d,width:n,...e})}),U=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,[t,s]=(0,u.useState)(0);return(0,i.m9)(t=>{s(s=>s+e*t)}),t},B=(0,i.l$)(i.W2,{colormap:n.r}),K=()=>{let e=U(.03),t=(0,i.Y0)();return(0,a.jsx)(i.jy,{anchor:.5,image:"/pianno-floating-logo.png",scale:.4,x:t.screen.width/2,y:t.screen.height/2+15*Math.sin(e)})},G=()=>{let{height:e,src:t,width:s}=(0,r.m2)(),{recenterViewport:l}=(0,r.WX)();return(0,u.useEffect)(()=>{l(s,e)},[s,e,l]),(0,a.jsx)(B,{colormap:{colorMap:c.xEZ.from("/cmaps/gray_colormap.png"),nearest:!0},children:(0,a.jsx)(i.jy,{image:t})})},J=e=>{let{setPos:t}=e,s=(0,r.m2)(),l=(0,r.MY)(),n=(0,r.ER)(),o=(0,i.Y0)(),c=d()(e=>{var s;t(null!==(s=null==n?void 0:n.toWorld(e.global))&&void 0!==s?s:e.global)},16),x=(0,u.useCallback)(c,[c]);return((0,u.useEffect)(()=>(o.stage.on("pointermove",x),()=>{o.stage.off("pointermove",x)}),[x,o.stage]),"#"!==s.src&&s.src)?(0,a.jsxs)(H,{children:[(0,a.jsx)(G,{}),(0,a.jsx)(h,{height:s.height,width:s.width}),l&&(0,a.jsx)(R,{}),(0,a.jsx)(g,{})]}):(0,a.jsx)(H,{children:(0,a.jsx)(K,{})})};var Q=()=>{c.VL4.defaultOptions.scaleMode=c.aH$.NEAREST;let[e,t]=(0,l.i)(),{src:s}=(0,r.m2)(),[n,o]=(0,u.useState)(new c.E9j(0,0));return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"fixed bottom-1 left-1",children:(0,a.jsxs)("span",{className:"z-20 rounded-md bg-muted p-1 text-sm font-semibold text-purple-600 shadow-sm selection:bg-transparent",children:[n.x.toFixed(2)," | ",n.y.toFixed(2)]})}),"#"!==s&&(0,a.jsx)(q,{}),(0,a.jsx)(k,{}),(0,a.jsx)(i.Hf,{height:t,options:{backgroundAlpha:0,eventMode:"static"},width:e,children:(0,a.jsx)(J,{setPos:o})})]})}},99:function(e,t,s){"use strict";s.r(t);var a=s(2872),r=s(4219);t.default=()=>(0,a.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center",children:[(0,a.jsx)(r.Z,{className:"h-10 w-10 animate-bounce fill-amber-600 stroke-transparent"}),(0,a.jsx)("span",{className:"text-amber-600",children:"Loading..."})]})},9021:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eN}});var a=s(2872),r=s(1521),l=s(458),n=s(2152),i=s(4031),o=s(8313),d=s(5627),c=s(7270),u=s(3299),x=s(9350),m=s(930),h=s(7943),f=s(4209),p=s(6589);let g=f.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,p.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...l})});g.displayName="Input";var j=s(2037),b=s(8011);let v=(0,b.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),y=f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(j.f,{ref:t,className:(0,p.cn)(v(),s),...r})});y.displayName=j.f.displayName;var N=s(6322);let w=f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(N.fC,{className:(0,p.cn)("peer inline-flex h-[24px] w-[44px] shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...r,ref:t,children:(0,a.jsx)(N.bU,{className:(0,p.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});w.displayName=N.fC.displayName;var k=s(1680),z=s(2210),C=s(9542),R=s(309),A=s(9688),E=s(117);let F=R.fC;R.ZA;let Z=R.B4,S=f.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(R.xz,{ref:t,className:(0,p.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...l,children:[r,(0,a.jsx)(R.JO,{asChild:!0,children:(0,a.jsx)(A.Z,{className:"h-4 w-4 opacity-50"})})]})});S.displayName=R.xz.displayName;let M=f.forwardRef((e,t)=>{let{className:s,children:r,position:l="popper",...n}=e;return(0,a.jsx)(R.h_,{children:(0,a.jsx)(R.VY,{ref:t,className:(0,p.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...n,children:(0,a.jsx)(R.l_,{className:(0,p.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r})})})});M.displayName=R.VY.displayName,f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(R.__,{ref:t,className:(0,p.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=R.__.displayName;let V=f.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(R.ck,{ref:t,className:(0,p.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(R.wU,{children:(0,a.jsx)(E.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(R.eT,{children:r})]})});V.displayName=R.ck.displayName,f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(R.Z0,{ref:t,className:(0,p.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=R.Z0.displayName;var W=e=>{let{}=e,[t,s]=(0,f.useState)(!1),[l,i]=(0,f.useState)(!1),{clear:o}=(0,r.VK)(e=>e),d=(0,f.useRef)(null),c=(0,r.iP)(),{setImage:p,setImageMetadata:j,softReset:b}=(0,r.WX)();(0,u.y1)(["3"],()=>{s(!0)});let v=(e,t,s)=>{let a=document.createElement("canvas");a.width=t,a.height=s;let r=a.getContext("2d");if(!r)return;r.clearRect(0,0,t,s);let l=r.getImageData(0,0,t,s),n=l.data;for(let t=0;t<e.length;t++){let s=e[t],a=4*t;n[a]=s,n[a+1]=s,n[a+2]=s,n[a+3]=255}return r.putImageData(l,0,0),a.toDataURL()},N=e=>{e.name===c.name&&e.size===c.size&&e.type===c.type&&c.name||b()},R=e=>{e.checked?(0,z.I$)({extensions:[".raw",".b",".bin"],mimeTypes:["application/octet-stream"]}).then(t=>{let s=new FileReader;s.onload=s=>{var a;let r;let l=null===(a=s.target)||void 0===a?void 0:a.result;switch(e.dtype){case"float64":default:r=Float64Array;break;case"float32":r=Float32Array;break;case"int32":r=Int32Array}let n=v(function(e){let t=0;for(let s=0;s<e.length;s++){let a=e[s];a>t&&(t=a)}for(let s=0;s<e.length;s++){let a=Math.round(e[s]/t*255);e[s]=a}return e}(Array.from(new r(l))),e.width,e.height),i={name:t.name,size:t.size,type:t.type};N(i),j(i),p({height:e.height,src:n,width:e.width}),C.A.success("Image loaded.")},s.readAsArrayBuffer(t)}).catch(()=>{C.A.error("Error loading image.")}):(0,z.I$)({extensions:[".png",".jpg",".jpeg",".gif"],mimeTypes:["image/png","image/jpeg","image/gif"]}).then(e=>{let t=new FileReader;t.onload=t=>{var s;let a=new Image;a.onload=()=>{let t={name:e.name,size:e.size,type:e.type};N(t),j(t),p({height:a.height,src:URL.createObjectURL(e),width:a.width}),C.A.success("Image loaded.")},a.src=null===(s=t.target)||void 0===s?void 0:s.result},t.readAsDataURL(e)}).catch(()=>{C.A.error("Error loading image.")})},A=e=>{s(e),e||i(!1)};return(0,a.jsxs)(h.Vq,{onOpenChange:A,open:t,children:[(0,a.jsx)(h.hg,{asChild:!0,children:(0,a.jsxs)(x.z,{className:"group relative",size:"icon",title:"load image -- 3",variant:"outline",children:[(0,a.jsx)("p",{className:"absolute right-1 top-0 text-xs text-input group-hover:text-accent-foreground",children:"3"}),(0,a.jsx)(n.Z,{className:"h-4 w-4"})]})}),(0,a.jsxs)(h.cZ,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(h.fK,{children:[(0,a.jsx)(h.$N,{children:"Load new image"}),(0,a.jsx)(h.Be,{children:l?"Fill in raw image metadata and click load.":"Click load."})]}),(0,a.jsxs)("form",{action:function(e){var t;null===(t=d.current)||void 0===t||t.reset(),(0,m.Av)(e).then(e=>{R(e),A(!1)}).catch(e=>{console.log(e)})},ref:d,children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2 text-center",children:[(0,a.jsx)("span",{className:"font-mono font-semibold",children:"PNG"}),(0,a.jsx)(w,{checked:l,name:"checked",onCheckedChange:i}),(0,a.jsx)("span",{className:"font-mono font-semibold",children:"RAW"})]}),l&&(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-2",children:[(0,a.jsx)(y,{htmlFor:"width",children:"Width"}),(0,a.jsx)(y,{htmlFor:"height",children:"Height"}),(0,a.jsx)(y,{htmlFor:"dtype",children:"Data type"}),(0,a.jsx)(g,{id:"width",min:1,name:"width",required:!0,type:"number"}),(0,a.jsx)(g,{id:"height",min:1,name:"height",required:!0,type:"number"}),(0,a.jsxs)(F,{name:"dtype",required:!0,children:[(0,a.jsx)(S,{id:"dtype",children:(0,a.jsx)(Z,{})}),(0,a.jsx)(M,{children:k.y7.map(e=>(0,a.jsx)(V,{className:"cursor-pointer",value:e,children:e},e))})]})]}),(0,a.jsx)(h.cN,{className:"mt-4",children:(0,a.jsx)(x.z,{type:"submit",children:"Load"})})]})]})]})},T=s(747);let D=T.fC,O=T.xz,Y=T.h_,L=f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(T.aV,{className:(0,p.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});L.displayName=T.aV.displayName;let I=f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsxs)(Y,{children:[(0,a.jsx)(L,{}),(0,a.jsx)(T.VY,{ref:t,className:(0,p.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]})});I.displayName=T.VY.displayName;let P=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,p.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};P.displayName="AlertDialogHeader";let _=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,p.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};_.displayName="AlertDialogFooter";let q=f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(T.Dx,{ref:t,className:(0,p.cn)("text-lg font-semibold",s),...r})});q.displayName=T.Dx.displayName;let $=f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(T.dk,{ref:t,className:(0,p.cn)("text-sm text-muted-foreground",s),...r})});$.displayName=T.dk.displayName;let X=f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(T.aU,{ref:t,className:(0,p.cn)((0,x.d)(),s),...r})});X.displayName=T.aU.displayName;let H=f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(T.$j,{ref:t,className:(0,p.cn)((0,x.d)({variant:"outline"}),"mt-2 sm:mt-0",s),...r})});H.displayName=T.$j.displayName;var U=s(4247),B=e=>{let{}=e,{recenterViewport:t,reset:s}=(0,r.WX)(),{clear:n}=(0,r.VK)(e=>e),[i,o]=(0,l.i)();return(0,a.jsxs)(D,{children:[(0,a.jsx)(O,{asChild:!0,children:(0,a.jsx)(x.z,{size:"icon",title:"reset",variant:"destructive",children:(0,a.jsx)(U.Z,{className:"h-4 w-4 hover:animate-reverse-spin"})})}),(0,a.jsxs)(I,{children:[(0,a.jsxs)(P,{children:[(0,a.jsx)(q,{children:"Are you absolutely sure?"}),(0,a.jsx)($,{children:"This action cannot be undone. This will permanently delete your annotations and reset your canvas."})]}),(0,a.jsxs)(_,{children:[(0,a.jsx)(H,{children:"Cancel"}),(0,a.jsx)(X,{onClick:()=>{s(),n(),t(i,o)},children:"Continue"})]})]})]})},K=s(4834);let G=f.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(K.fC,{ref:t,className:(0,p.cn)("relative overflow-hidden",s),...l,children:[(0,a.jsx)(K.l_,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(J,{}),(0,a.jsx)(K.Ns,{})]})});G.displayName=K.fC.displayName;let J=f.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...l}=e;return(0,a.jsx)(K.gb,{ref:t,orientation:r,className:(0,p.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 border-t border-t-transparent p-[1px]",s),...l,children:(0,a.jsx)(K.q4,{className:(0,p.cn)("relative rounded-full bg-border","vertical"===r&&"flex-1")})})});J.displayName=K.gb.displayName;var Q=s(8399),ee=s(9740),et=s(1572),es=s(1787),ea=s(6183),er=s(1371),el=e=>{let{disabled:t}=e,[s,l]=function(){let[e,t]=(0,f.useState)(null);return[e,async e=>{var s;if(!(null===(s=navigator)||void 0===s?void 0:s.clipboard))return console.warn("Clipboard not supported"),!1;try{return await navigator.clipboard.writeText(e),t(e),!0}catch(e){return console.warn("Copy failed",e),t(null),!1}}]}(),[n,i]=(0,f.useState)(!1),[o,d]=(0,f.useState)(!1),c=(0,r.Wk)(),p=(0,r.VN)(),j=(0,r.ER)(),{setBrushMode:b}=(0,r.WX)(),v=(0,r.MY)(),{toggle:N}=(0,r.WX)(),[w,R]=(0,f.useState)({}),A=Object.values(w).length>0&&!Object.values(w).some(e=>2!==e.length);(0,f.useEffect)(()=>{(0,m.L0)(p).then(e=>{R(e)})},[p]),(0,u.y1)(["4"],()=>{v||N(),b(void 0),d(!0)},{enabled:!t});let W=()=>{o?b("pen"):b(void 0),v||N(),d(!o)},T=e=>{let t=new Blob([JSON.stringify(e)],{type:"application/json"});(0,z.NL)(t,{extensions:[".json"],fileName:"annot.json"}).then(()=>{d(!1),C.A.success("Annotations saved successfully!")}).catch(e=>{C.A.error("Annotations could not be saved!")})},Y=e=>{l(JSON.stringify(e)).then(()=>{i(!0),C.A.success("Annotations copied to clipboard!"),setTimeout(()=>{i(!1)},1e3)}).catch(e=>{C.A.error("Annotations could not be copied!")})};async function L(e){T(await (0,m.yg)(e,p))}async function X(e){Y(await (0,m.yg)(e,p))}let U=e=>c.vertical.includes(e)?"vertical":c.horizontal.includes(e)?"horizontal":c.euclidean.includes(e)?"euclidean":void 0;return(0,a.jsx)(a.Fragment,{children:A?(0,a.jsxs)(h.Vq,{modal:!1,onOpenChange:W,open:o,children:[(0,a.jsx)(h.hg,{asChild:!0,children:(0,a.jsxs)(x.z,{className:"group relative",disabled:t,size:"icon",title:"save json -- 4",variant:"outline",children:[(0,a.jsx)("p",{className:"absolute right-1 top-0 text-xs text-input group-hover:text-accent-foreground",children:"4"}),(0,a.jsx)(Q.Z,{className:"h-4 w-4"})]})}),(0,a.jsxs)(h.cZ,{className:"left-auto right-1 translate-x-0 opacity-95 sm:max-w-[350px]",onPointerDownOutside:e=>e.preventDefault(),children:[(0,a.jsxs)(h.fK,{children:[(0,a.jsx)(h.$N,{children:"Save your Annotations"}),(0,a.jsx)(h.Be,{children:"Fill in the following fields with the annotation metadata. Click save or copy to clipboard when you are done."})]}),(0,a.jsxs)("form",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(y,{className:"absolute left-2 top-1 z-10 -translate-y-2 scale-75 text-sm font-semibold text-muted-foreground",htmlFor:"device",children:"Device"}),(0,a.jsxs)(F,{name:"device",required:!0,children:[(0,a.jsx)(S,{id:"device",children:(0,a.jsx)(Z,{})}),(0,a.jsx)(M,{children:k.JH.map(e=>(0,a.jsx)(V,{className:"cursor-pointer",value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(y,{className:"absolute left-2 top-1 z-10 -translate-y-2 scale-75 text-sm font-semibold text-muted-foreground",htmlFor:"device-id",children:"#"}),(0,a.jsx)(g,{className:"peer",id:"device-id",max:5,min:1,name:"device-id",required:!0,type:"number"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(y,{className:"absolute left-2 top-1 z-10 -translate-y-2 scale-75 text-sm font-semibold text-muted-foreground",htmlFor:"geometry",children:"Geometry"}),(0,a.jsxs)(F,{name:"geometry",required:!0,children:[(0,a.jsx)(S,{id:"geometry",children:(0,a.jsx)(Z,{})}),(0,a.jsx)(M,{children:k.wM.map(e=>(0,a.jsx)(V,{className:"cursor-pointer",value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(y,{className:"absolute top-1 z-10 -translate-y-2 scale-75 text-sm text-muted-foreground",htmlFor:"distance",children:["Distance ",(0,a.jsx)("span",{className:"font-light",children:"(mm)"})]}),(0,a.jsx)(g,{className:"peer",id:"distance",min:0,name:"distance",required:!0,type:"number"})]})]}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-2"}),(0,a.jsx)("div",{className:"",children:(0,a.jsx)(G,{className:"h-[350px]",children:(0,a.jsx)("div",{className:"flex flex-col gap-2",children:Object.entries(w||{}).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2 p-2",children:[(0,a.jsxs)(x.z,{className:"group rounded-full border px-3",onClick:()=>{null==j||j.snap(s[0].x,s[0].y,{removeOnComplete:!0}),null==j||j.setZoom(5)},size:"icon",style:{borderColor:t},title:"go to pair",type:"button",variant:"outline",children:[(0,a.jsx)(et.Z,{className:"hidden h-4 w-4 scale-125 group-focus:block group-focus:animate-in",stroke:t}),(0,a.jsx)(es.Z,{className:"h-4 w-4 scale-125 group-focus:hidden",stroke:t})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(y,{className:"absolute left-2 top-1 z-10 -translate-y-2 scale-75 text-sm font-semibold text-muted-foreground",htmlFor:t,children:["Distance"," ",(0,a.jsx)("span",{className:"font-light",children:"(pixels)"})]}),(0,a.jsx)(g,{className:"w-full",id:t,min:-1,name:"pair-distance",required:!0,type:"number"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(y,{className:"absolute left-2 top-1 z-10 -translate-y-2 scale-75 text-sm font-semibold text-muted-foreground",htmlFor:(s[0].x+s[0].y).toString(),children:"Type"}),(0,a.jsxs)(F,{defaultValue:U(t),name:"pair-distance-type",required:!0,children:[(0,a.jsx)(S,{className:"w-24",id:(s[0].x+s[0].y).toString(),children:(0,a.jsx)(Z,{})}),(0,a.jsx)(M,{children:k.Yx.map(e=>(0,a.jsx)(V,{className:"cursor-pointer",value:e,children:e},e))})]})]})]},t)})})})}),(0,a.jsx)(h.cN,{className:"relative",children:(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[n?(0,a.jsxs)(x.z,{className:"text-xs",variant:"outline",children:[(0,a.jsx)(E.Z,{className:"mr-2 h-4 w-4"}),"Copied!"]}):(0,a.jsxs)(x.z,{className:"text-xs",formAction:X,type:"submit",variant:"outline",children:[(0,a.jsx)(ea.Z,{className:"mr-2 h-4 w-4"}),"Copy to clipboard"]}),(0,a.jsxs)(x.z,{className:"text-xs",formAction:L,type:"submit",variant:"default",children:[(0,a.jsx)(er.Z,{className:"mr-2 h-4 w-4"}),"Save JSON"]})]})})]})]})]}):(0,a.jsxs)(D,{onOpenChange:W,open:o,children:[(0,a.jsx)(O,{asChild:!0,children:(0,a.jsxs)(x.z,{className:"group relative",disabled:t,size:"icon",title:"save json -- 4",variant:"outline",children:[(0,a.jsx)("p",{className:"absolute right-1 top-0 text-xs text-input group-hover:text-accent-foreground",children:"4"}),(0,a.jsx)(Q.Z,{className:"h-4 w-4 group-hover:hidden group-hover:animate-out"}),(0,a.jsx)(ee.Z,{className:"hidden h-4 w-4 scale-125 stroke-red-600 group-hover:block group-hover:animate-in"})]})}),(0,a.jsxs)(I,{children:[(0,a.jsxs)(P,{children:[(0,a.jsx)(q,{children:"Can't save!"}),(0,a.jsx)($,{children:0===Object.values(w).length?(0,a.jsx)(a.Fragment,{children:"You need to annotate at least one pair of points before saving."}):(0,a.jsxs)(a.Fragment,{children:["The annotations should be in pairs. Please check annotations with a"," ",(0,a.jsx)("span",{className:"inline font-bold text-violet-700",children:"X"})," ","marker or single points surrounded by a circle and remove them before saving."]})})]}),(0,a.jsx)(_,{children:(0,a.jsx)(H,{children:"Go back"})})]})]})})},en=s(8423),ei=s(1032),eo=s(6263);let ed=(0,b.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),ec=f.forwardRef((e,t)=>{let{className:s,variant:r,size:l,...n}=e;return(0,a.jsx)(eo.f,{ref:t,className:(0,p.cn)(ed({variant:r,size:l,className:s})),...n})});ec.displayName=eo.f.displayName;var eu=e=>{let{disabled:t}=e;(0,u.y1)("5",()=>{l()},{enabled:!t});let s=(0,r.MY)(),{toggle:l}=(0,r.WX)();return(0,a.jsxs)(ec,{"aria-label":"toggle pairs -- 5",className:"group relative",disabled:t,onPressedChange:l,pressed:s,title:"toggle pairs -- 5",children:[(0,a.jsx)("p",{className:"absolute right-1 top-0 text-xs text-input group-hover:text-accent-foreground",children:"5"}),s?(0,a.jsx)(en.Z,{className:"h-4 w-4"}):(0,a.jsx)(ei.Z,{className:"h-4 w-4"})]})},ex=s(6324),em=s(5939);let eh=f.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(ex.fC,{className:(0,p.cn)("grid gap-2",s),...r,ref:t})});eh.displayName=ex.fC.displayName;let ef=f.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsx)(ex.ck,{ref:t,className:(0,p.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...l,children:(0,a.jsx)(ex.z$,{className:"flex items-center justify-center",children:(0,a.jsx)(em.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});ef.displayName=ex.ck.displayName;var ep=s(5296),eg=s(6671);let ej=e=>{let{hotkey:t,icon:s,title:r}=e;return(0,a.jsxs)(y,{className:"group relative flex h-10 w-10 cursor-pointer items-center justify-center rounded-md border border-input bg-popover hover:bg-accent peer-data-[state=checked]:border-violet-600 peer-data-[state=checked]:bg-violet-400 peer-data-[state=checked]:[&>p]:text-violet-700 peer-data-[state=checked]:[&>svg]:fill-violet-500 peer-data-[state=checked]:[&>svg]:stroke-violet-700",htmlFor:r.split(" ")[0],title:r,children:[(0,a.jsx)("p",{className:"absolute right-1 top-0 text-xs text-input group-hover:text-accent-foreground",children:t}),s]})},eb=[{hotkey:"1",icon:(0,a.jsx)(ep.Z,{className:"h-4 w-4"}),title:"pen -- 1 or p"},{hotkey:"2",icon:(0,a.jsx)(eg.Z,{className:"h-4 w-4"}),title:"eraser -- 2 or e"}];var ev=e=>{let{}=e,{mode:t}=(0,r.uu)(),{setBrushMode:s}=(0,r.WX)();return(0,u.y1)(["1","p"],()=>s("pen"),{enabled:void 0!==t}),(0,u.y1)(["2","e"],()=>s("eraser"),{enabled:void 0!==t}),(0,a.jsx)(eh,{className:"flex flex-row gap-1",onValueChange:e=>s(e),value:t,children:eb.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)(ef,{className:"peer sr-only",id:e.title.split(" ")[0],value:e.title.split(" ")[0]}),(0,a.jsx)(ej,{hotkey:e.hotkey,icon:e.icon,title:e.title})]},e.title))})};let ey=()=>{let{name:e}=(0,r.iP)();return e?(0,a.jsx)("div",{className:"fixed inset-x-0 top-20 z-10 text-center text-violet-300",children:(0,a.jsxs)("span",{className:"flex-row items-center justify-center font-mono font-semibold",children:[(0,a.jsx)(i.Z,{className:"inline-block h-4 w-4 animate-pulse stroke-yellow-700"})," ","It looks like you were previously working with an image: ",(0,a.jsx)("span",{className:"font-bold text-blue-600 underline opacity-60",children:e}),".",(0,a.jsx)("br",{}),"If you want to continue working on this image, please load it again."," ",(0,a.jsx)(i.Z,{className:"inline-block h-4 w-4 animate-pulse stroke-yellow-700"})]})}):(0,a.jsx)("div",{className:"fixed inset-x-0 top-20 z-10 text-center text-violet-300",children:(0,a.jsxs)("span",{className:"flex-row items-center justify-center font-mono font-semibold",children:["Please load an image to start ",(0,a.jsx)(n.Z,{className:"inline-block h-4 w-4 animate-pulse stroke-violet-800"})," "]})})};var eN=()=>{let{recenterViewport:e}=(0,r.WX)(),{futureStates:t,pastStates:s,redo:n,undo:i}=(0,r.VK)(e=>e),m=!!s.length,h=!!t.length,[f,p]=(0,l.i)(),g=(0,r.m2)(),j="#"!==g.src;(0,u.y1)(["6","ctrl+z"],()=>{i()},{enabled:m}),(0,u.y1)(["7","ctrl+y"],()=>{n()},{enabled:h}),(0,u.y1)(["8"],()=>{e(g.width?g.width:f,g.height?g.height:p)});let b=[{children:(0,a.jsx)(o.Z,{className:"h-4 w-4"}),disabled:!m,hotkey:"6",onClick:()=>{i()},title:"undo -- 6 or ctrl+z"},{children:(0,a.jsx)(d.Z,{className:"h-4 w-4"}),disabled:!h,hotkey:"7",onClick:()=>{n()},title:"redo -- 7 or ctrl+y"},{children:(0,a.jsx)(c.Z,{className:"h-4 w-4"}),hotkey:"8",onClick:()=>e(g.width?g.width:f,g.height?g.height:p),title:"fit-view -- 8"}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"fixed inset-x-0 top-4 z-10 mx-auto flex w-fit flex-row items-center justify-center gap-2 rounded-lg bg-background p-1 opacity-95 shadow-lg",children:[(0,a.jsx)(ev,{}),(0,a.jsx)("span",{className:"flex text-center text-input",children:"|"}),(0,a.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,a.jsx)(W,{}),(0,a.jsx)(el,{disabled:!j}),(0,a.jsx)(eu,{disabled:!j}),b.map(e=>{var t;return(0,a.jsxs)(x.z,{className:"group relative",disabled:e.disabled,onClick:null==e?void 0:e.onClick,size:"icon",title:e.title,variant:null!==(t=e.variant)&&void 0!==t?t:"outline",children:[(0,a.jsx)("p",{className:"absolute right-1 top-0 text-xs text-input group-hover:text-accent-foreground",children:e.hotkey}),e.children]},e.title)}),(0,a.jsx)(B,{})]})]}),"#"===g.src&&(0,a.jsx)(ey,{})]})}},9350:function(e,t,s){"use strict";s.d(t,{d:function(){return o},z:function(){return d}});var a=s(2872),r=s(4209),l=s(2957),n=s(8011),i=s(6589);let o=(0,n.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:s,variant:r,size:n,asChild:d=!1,...c}=e,u=d?l.g7:"button";return(0,a.jsx)(u,{className:(0,i.cn)(o({variant:r,size:n,className:s})),ref:t,...c})});d.displayName="Button"},7943:function(e,t,s){"use strict";s.d(t,{$N:function(){return f},Be:function(){return p},Vq:function(){return o},cN:function(){return h},cZ:function(){return x},fK:function(){return m},hg:function(){return d}});var a=s(2872),r=s(4209),l=s(5566),n=s(5119),i=s(6589);let o=l.fC,d=l.xz,c=e=>{let{className:t,...s}=e;return(0,a.jsx)(l.h_,{className:(0,i.cn)(t),...s})};c.displayName=l.h_.displayName;let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});u.displayName=l.aV.displayName;let x=r.forwardRef((e,t)=>{let{className:s,children:r,...o}=e;return(0,a.jsxs)(c,{children:[(0,a.jsx)(u,{}),(0,a.jsxs)(l.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full",s),...o,children:[r,(0,a.jsxs)(l.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(n.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=l.VY.displayName;let m=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};m.displayName="DialogHeader";let h=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};h.displayName="DialogFooter";let f=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});f.displayName=l.Dx.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})});p.displayName=l.dk.displayName},1521:function(e,t,s){"use strict";s.d(t,{ER:function(){return u},MY:function(){return f},VK:function(){return c},VN:function(){return g},WX:function(){return j},Wk:function(){return x},iP:function(){return b},m2:function(){return h},uG:function(){return m},uu:function(){return p}});var a=s(1680),r=s(1611),l=s(3474),n=s(5454),i=s(2416);let o={brush:{eraserSize:5,maxSize:10,mode:"pen",penSize:1},colors:a.Rc,currentColor:a.Rc.euclidean[0],img:{height:0,src:"#",width:0},imgMetadata:{name:"",size:0,type:""},label:"data:image/png;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",toggled:!0,viewport:null},d=(0,l.Ue)()((0,n.tJ)((0,r.temporal)((e,t)=>({...o,actions:{recenterViewport:(e,s)=>{let a=t().viewport;null==a||a.moveCenter(e/2,s/2),null==a||a.fit(!0,e,s)},reset:()=>{e(o),window.location.reload()},setBrushMode:s=>{e({brush:{...t().brush,mode:s}})},setBrushSize:s=>{let a=t().brush;"eraser"===a.mode?e({brush:{...a,eraserSize:s}}):"pen"===a.mode&&e({brush:{...a,penSize:s}})},setColor:t=>e({currentColor:t}),setImage:s=>{e({img:s});let{height:a,width:r}=s;if(a&&r){let s=Math.floor(.04*Math.max(a,r));e({brush:{...t().brush,eraserSize:Math.floor(s/2),maxSize:s}})}},setImageMetadata:t=>e({imgMetadata:t}),setLabel:t=>e({label:t}),setNewColor:(s,a)=>{let r=t().colors;Object.values(r).some(e=>e.includes(s))||(e({colors:{...r,[a]:[...r[a],s]}}),e({currentColor:s}))},setViewport:t=>e({viewport:t}),softReset:()=>{e({colors:o.colors,label:o.label})},toggle:()=>e(e=>({toggled:!e.toggled}))}}),{equality:i.X,partialize:e=>({label:e.label})}),{name:"store",partialize:e=>({brush:e.brush,colors:e.colors,currentColor:e.currentColor,imgMetadata:e.imgMetadata,label:e.label})})),c=e=>(0,l.oR)(d.temporal,e),u=()=>d(e=>e.viewport),x=()=>d(e=>e.colors),m=()=>d(e=>e.currentColor),h=()=>d(e=>e.img),f=()=>d(e=>e.toggled),p=()=>d(e=>{let t=e.brush;return"eraser"===t.mode?{...t,size:t.eraserSize}:"pen"===t.mode?{...t,size:t.penSize}:{...t,size:1}}),g=()=>d(e=>e.label),j=()=>d(e=>e.actions),b=()=>d(e=>e.imgMetadata)},458:function(e,t,s){"use strict";s.d(t,{i:function(){return r}});var a=s(4209);function r(){let[e,t]=(0,a.useState)([0,0]);return(0,a.useLayoutEffect)(()=>{function e(){t([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e}},1680:function(e,t,s){"use strict";s.d(t,{JH:function(){return a},Rc:function(){return o},Yx:function(){return i},wM:function(){return r},y7:function(){return l}});let a=["pi135D","pi450D","pi540D"],r=["planar","nonplanar","arc","tower"],l=["float32","float64","int32"],n={purples:["#3e4989","#423f85","#482878","#440154"],teals:["#21a685","#1f9e89","#228c8d","#26828e"],yellows:["#b5de2b","#d0e11c","#e7e419","#fde725"]},i=["euclidean","horizontal","vertical"],o={euclidean:n.purples,horizontal:n.teals,vertical:n.yellows}},6589:function(e,t,s){"use strict";s.d(t,{cn:function(){return l},dI:function(){return i},qw:function(){return n}});var a=s(7072),r=s(960);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m)((0,a.W)(t))}let n=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),i=(e,t)=>Math.atan2(t.x-e.x,t.y-e.y)}},function(e){e.O(0,[999,542,895,577,726,744],function(){return e(e.s=6767)}),_N_E=e.O()}]);